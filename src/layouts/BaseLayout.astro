---
// src/layouts/BaseLayout.astro
import Header from "../components/layout/Header.astro";
import Footer from "../components/layout/Footer.astro";
import AmbientBlur from "../components/effects/AmbientBlur.astro";
import Chatbot from "../components/features/chatbot/Chatbot.astro";
import "../styles/user.css";

// Definición estricta de Props para TS
export interface Props {
  title: string;
  description: string;
  image?: string; // Opcional para OpenGraph dinámico en el futuro
}

const {
  title,
  description,
  image = "/image.png", // Fallback default image
} = Astro.props;

// Configuración de colores Telcel Modernizados para selección
const selectionClass =
  "selection:bg-blue-600 selection:text-white dark:selection:bg-blue-500 dark:selection:text-white";
---

<!doctype html>
<html lang="es-MX" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEO & Favicon -->
    <link rel="icon" type="image/svg+xml" href="/logo-white.svg" />
    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- Open Graph (Básico para compartir en WhatsApp/FB) -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />
    <meta property="og:type" content="website" />

    <!-- Google Fonts: Inter o similar suele ser mejor para Retail, pero mantenemos Material Icons si se usan en UI -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Round"
    />

    <!-- Theme Initialization Script: Critical Rendering Path -->
    <script is:inline>
      (function () {
        const savedTheme = localStorage.getItem("theme");
        const systemPrefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;

        // Lógica robusta para evitar FOUC (Flash of Unstyled Content)
        if (savedTheme === "dark" || (!savedTheme && systemPrefersDark)) {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
      })();
    </script>
  </head>

  <!-- 
    BODY STYLING STRATEGY:
    1. Light Mode: bg-slate-50 (Limpio, profesional, alto contraste para lectura B2B).
    2. Dark Mode: bg-[#0B1120] (Navy Profundo solicitado, ideal para resaltar 'Glows' tecnológicos).
    3. Text: Contraste AAA para accesibilidad.
  -->
  <body
    class:list={[
      "antialiased min-h-screen flex flex-col transition-colors duration-200 overflow-x-hidden",
      "bg-slate-50 text-slate-900", // Light Theme
      "dark:bg-slate-900 dark:text-slate-200", // Dark Theme (Navy Deep)
      selectionClass,
    ]}
  >
    <div class="hidden md:block absolute top-0 right-0 z-[-1]">
      <svg
        width="450"
        height="556"
        viewBox="0 0 450 556"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle cx="277" cy="63" r="225" fill="url(#paint0_linear_25:217)"
        ></circle>
        <circle cx="17.9997" cy="182" r="18" fill="url(#paint1_radial_25:217)"
        ></circle>
        <circle cx="76.9997" cy="288" r="34" fill="url(#paint2_radial_25:217)"
        ></circle>
        <circle
          cx="325.486"
          cy="302.87"
          r="180"
          transform="rotate(-37.6852 325.486 302.87)"
          fill="url(#paint3_linear_25:217)"></circle>
        <circle
          opacity="0.8"
          cx="184.521"
          cy="315.521"
          r="132.862"
          transform="rotate(114.874 184.521 315.521)"
          stroke="url(#paint4_linear_25:217)"></circle>
        <circle
          opacity="0.8"
          cx="356"
          cy="290"
          r="179.5"
          transform="rotate(-30 356 290)"
          stroke="url(#paint5_linear_25:217)"></circle>
        <circle
          opacity="0.8"
          cx="191.659"
          cy="302.659"
          r="133.362"
          transform="rotate(133.319 191.659 302.659)"
          fill="url(#paint6_linear_25:217)"></circle>
        <defs>
          <linearGradient
            id="paint0_linear_25:217"
            x1="-54.5003"
            y1="-178"
            x2="222"
            y2="288"
            gradientUnits="userSpaceOnUse"
          >
            <stop stop-color="#4A6CF7"></stop>
            <stop offset="1" stop-color="#4A6CF7" stop-opacity="0"></stop>
          </linearGradient>
          <radialGradient
            id="paint1_radial_25:217"
            cx="0"
            cy="0"
            r="1"
            gradientUnits="userSpaceOnUse"
            gradientTransform="translate(17.9997 182) rotate(90) scale(18)"
          >
            <stop offset="0.145833" stop-color="#4A6CF7" stop-opacity="0"
            ></stop>
            <stop offset="1" stop-color="#4A6CF7" stop-opacity="0.08"></stop>
          </radialGradient>
          <radialGradient
            id="paint2_radial_25:217"
            cx="0"
            cy="0"
            r="1"
            gradientUnits="userSpaceOnUse"
            gradientTransform="translate(76.9997 288) rotate(90) scale(34)"
          >
            <stop offset="0.145833" stop-color="#4A6CF7" stop-opacity="0"
            ></stop>
            <stop offset="1" stop-color="#4A6CF7" stop-opacity="0.08"></stop>
          </radialGradient>
          <linearGradient
            id="paint3_linear_25:217"
            x1="226.775"
            y1="-66.1548"
            x2="292.157"
            y2="351.421"
            gradientUnits="userSpaceOnUse"
          >
            <stop stop-color="#4A6CF7"></stop>
            <stop offset="1" stop-color="#4A6CF7" stop-opacity="0"></stop>
          </linearGradient>
          <linearGradient
            id="paint4_linear_25:217"
            x1="184.521"
            y1="182.159"
            x2="184.521"
            y2="448.882"
            gradientUnits="userSpaceOnUse"
          >
            <stop stop-color="#4A6CF7"></stop>
            <stop offset="1" stop-color="white" stop-opacity="0"></stop>
          </linearGradient>
          <linearGradient
            id="paint5_linear_25:217"
            x1="356"
            y1="110"
            x2="356"
            y2="470"
            gradientUnits="userSpaceOnUse"
          >
            <stop stop-color="#4A6CF7"></stop>
            <stop offset="1" stop-color="white" stop-opacity="0"></stop>
          </linearGradient>
          <linearGradient
            id="paint6_linear_25:217"
            x1="118.524"
            y1="29.2497"
            x2="166.965"
            y2="338.63"
            gradientUnits="userSpaceOnUse"
          >
            <stop stop-color="#4A6CF7"></stop>
            <stop offset="1" stop-color="#4A6CF7" stop-opacity="0"></stop>
          </linearGradient>
        </defs>
      </svg>
    </div>
    <div class="absolute left-0 bottom-5 z-[-1]">
      <svg
        width="279"
        height="106"
        viewBox="0 0 279 106"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <g opacity="0.5">
          <path
            d="M-57 12L50.0728 74.8548C55.5501 79.0219 70.8513 85.7589 88.2373 79.3692C109.97 71.3821 116.861 60.9642 156.615 63.7423C178.778 65.291 195.31 69.2985 205.911 62.3533C216.513 55.408 224.994 47.7682 243.016 49.1572C255.835 50.1453 265.278 50.8936 278 45.3373"
            stroke="url(#paint0_linear_72:302)"></path>
          <path
            d="M-57 1L50.0728 63.8548C55.5501 68.0219 70.8513 74.7589 88.2373 68.3692C109.97 60.3821 116.861 49.9642 156.615 52.7423C178.778 54.291 195.31 58.2985 205.911 51.3533C216.513 44.408 224.994 36.7682 243.016 38.1572C255.835 39.1453 265.278 39.8936 278 34.3373"
            stroke="url(#paint1_linear_72:302)"></path>
          <path
            d="M-57 23L50.0728 85.8548C55.5501 90.0219 70.8513 96.7589 88.2373 90.3692C109.97 82.3821 116.861 71.9642 156.615 74.7423C178.778 76.291 195.31 80.2985 205.911 73.3533C216.513 66.408 224.994 58.7682 243.016 60.1572C255.835 61.1453 265.278 61.8936 278 56.3373"
            stroke="url(#paint2_linear_72:302)"></path>
          <path
            d="M-57 35L50.0728 97.8548C55.5501 102.022 70.8513 108.759 88.2373 102.369C109.97 94.3821 116.861 83.9642 156.615 86.7423C178.778 88.291 195.31 92.2985 205.911 85.3533C216.513 78.408 224.994 70.7682 243.016 72.1572C255.835 73.1453 265.278 73.8936 278 68.3373"
            stroke="url(#paint3_linear_72:302)"></path>
        </g>
        <defs>
          <linearGradient
            id="paint0_linear_72:302"
            x1="256.267"
            y1="53.6717"
            x2="-40.8688"
            y2="8.15715"
            gradientUnits="userSpaceOnUse"
          >
            <stop stop-color="#4A6CF7" stop-opacity="0"></stop>
            <stop offset="1" stop-color="#4A6CF7"></stop>
          </linearGradient>
          <linearGradient
            id="paint1_linear_72:302"
            x1="256.267"
            y1="42.6717"
            x2="-40.8688"
            y2="-2.84285"
            gradientUnits="userSpaceOnUse"
          >
            <stop stop-color="#4A6CF7" stop-opacity="0"></stop>
            <stop offset="1" stop-color="#4A6CF7"></stop>
          </linearGradient>
          <linearGradient
            id="paint2_linear_72:302"
            x1="256.267"
            y1="64.6717"
            x2="-40.8688"
            y2="19.1572"
            gradientUnits="userSpaceOnUse"
          >
            <stop stop-color="#4A6CF7" stop-opacity="0"></stop>
            <stop offset="1" stop-color="#4A6CF7"></stop>
          </linearGradient>
          <linearGradient
            id="paint3_linear_72:302"
            x1="256.267"
            y1="76.6717"
            x2="-40.8688"
            y2="31.1572"
            gradientUnits="userSpaceOnUse"
          >
            <stop stop-color="#4A6CF7" stop-opacity="0"></stop>
            <stop offset="1" stop-color="#4A6CF7"></stop>
          </linearGradient>
        </defs>
      </svg>
    </div>
    <!-- === CAPA AMBIENTAL (Background) === -->
    <div
      class="fixed inset-0 z-0 pointer-events-none select-none overflow-hidden"
    >
      <!-- 1. Grilla Técnica: Opacidad ajustada para no ensuciar el diseño limpio -->
      <div
        class="absolute inset-0 z-0 opacity-[0.7] dark:opacity-[0.7]"
        style="
          background-image: 
            linear-gradient(to right, #64748b1a 1px, transparent 1px), 
            linear-gradient(to bottom, #64748b1a 1px, transparent 1px); 
          background-size: 40px 40px;
          mask-image: radial-gradient(circle at center, black 40%, transparent 100%);
          -webkit-mask-image: radial-gradient(circle at center, black 40%, transparent 100%);
        "
      >
      </div>
      <!-- BACKGROUND GLOBAL (Deep Navy) -->
      <div
        class="fixed inset-0 pointer-events-none opacity-[0.3] dark:opacity-[0.1] z-0"
      >
        <svg class="w-full h-full mix-blend-overlay"
          ><filter id="noise"
            ><feTurbulence
              type="fractalNoise"
              baseFrequency="0.8"
              numOctaves="3"
              stitchTiles="stitch"></feTurbulence></filter
          ><rect width="100%" height="100%" filter="url(#noise)"></rect></svg
        >
      </div>

      <!-- 2. Ambient Blur: Los "Glows" de acento -->
      <AmbientBlur />
    </div>

    <!-- === LAYOUT PRINCIPAL === -->

    <!-- Header Sticky -->
    <Header />

    <!-- Main Content: Padding ajustado para Mobile-First y evitar solapamiento con Header -->
    <main
      class="relative z-10 flex-grow flex flex-col pt-[5rem] pb-[5rem] md:pt-[5rem] md:pb-[5rem] animate-fade-in"
    >
      <slot />
    </main>

    <!-- Footer -->
    <div class="relative z-10 mt-auto">
      <Footer />
    </div>

    <!-- Floating Elements -->
    <Chatbot />

    <!-- Global Styles Refinement -->
    <style is:global>
      /* Tipografía Premium */
      body {
        font-family:
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          Oxygen,
          Ubuntu,
          Cantarell,
          "Open Sans",
          "Helvetica Neue",
          sans-serif;
        font-feature-settings: "cv11", "ss01";
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale; /* Texto más nítido en MacOS/iOS */
      }

      /* Scrollbar Personalizado (Sutil y elegante) */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background-color: #cbd5e1; /* Slate-300 */
        border-radius: 20px;
      }

      /* Dark Mode Scrollbar */
      .dark ::-webkit-scrollbar-thumb {
        background-color: #1e293b; /* Slate-800 - se integra con el Navy */
      }
      .dark ::-webkit-scrollbar-thumb:hover {
        background-color: #334155;
      }

      /* Animación de entrada suave para el contenido */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fade-in {
        animation: fadeIn 0.6s ease-out forwards;
      }
    </style>
  </body>
</html>
