---
// src/pages/empresas.astro
import BaseLayout from "../layouts/BaseLayout.astro";
import PlansOrchestrator from "../components/PlansOrchestrator.astro";
import BenefitsSection from "../components/BenefitsSection.astro";
import "../styles/user.css";

import {
  getPlansEmpresas,
  getPlansInternetEmpresa,
  getPlansEmpresasUltra,
  getInternetEnTuEmpresa,
} from "../services/contentful";

// --- Helper para mapear datos seguros ---
const safeMap = (plans: any[], category: "movil" | "casa") => {
  if (!Array.isArray(plans)) return [];
  return plans
    .map((p) => {
      const f = p.fields || {};
      return {
        titulo: (f.titulo as string) || "Plan",
        datosIncluidos: (f.datosIncluidos as string) || "Datos",
        precio: Number(f.precio) || 0,
        recomendado: (f.recomendado as boolean) || false,
        enlace: (f.enlace as string) || "#",
        // Campos específicos mapeados a props universales
        redesSociales: (f.redesSociales as string[]) || [],
        minutosYSms: f.minutosYSmsIncluidos as string, // Unificar nombre prop
        cashbackTelcel: f.cashbackTelcel as string,
        velocidadDeNavegacion: f.velocidadDeNavegacion as string,
        politicaDeUsoJusto:
          ((f.politicaDeUsoJusto as string) || "").trim() ||
          "Política de uso justo aplica",
      };
    })
    .filter((p) => p.precio > 0)
    .sort((a, b) => a.precio - b.precio);
};
// Fetch Paralelo para velocidad
const [rawLibre, rawUltra, rawMovilInt, rawCasaInt] = await Promise.all([
  getPlansEmpresas().catch(() => []),
  getPlansEmpresasUltra().catch(() => []),
  getPlansInternetEmpresa().catch(() => []),
  getInternetEnTuEmpresa().catch(() => []),
]);

console.log("DEBUG: rawCasaInt", JSON.stringify(rawCasaInt, null, 2));

const libreEmpresas = safeMap(rawLibre, "movil");
const ultraEmpresas = safeMap(rawUltra, "movil");
const movilInternetEmpresas = safeMap(rawMovilInt, "movil");
const internetEmpresas = safeMap(rawCasaInt, "casa");
---

<BaseLayout
  title="Soluciones Empresariales | Grupo Linea Digital"
  description="Planes corporativos y soluciones de conectividad para tu empresa."
>
  <!-- Hero Section Empresarial (Más sobrio) -->
  <section class="relative overflow-hidden pt-12">
    <div class="container mx-auto px-4 text-center">
      <div class="mb-8 flex justify-center">
        <span
          class="inline-flex items-center gap-2 rounded-full border border-blue-200/60 bg-white/60 px-4 py-1.5 text-xs font-bold uppercase tracking-widest text-blue-700 backdrop-blur-md transition-all hover:scale-105 hover:bg-white/80 dark:border-blue-500/20 dark:bg-blue-900/20 dark:text-blue-300 cursor-default shadow-sm"
        >
          <span class="relative flex h-2 w-2">
            <span
              class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"
            ></span>
            <span
              class="relative inline-flex rounded-full h-2 w-2 bg-blue-500 dark:bg-blue-400"
            ></span>
          </span>
          Para Empresas
        </span>
      </div>
      <h1
        class="text-4xl sm:text-5xl md:text-6xl font-bold text-slate-900 dark:text-white mb-6 tracking-tight"
      >
        ¡La mejor tecnología para conectar a tu <span
          class="text-transparent bg-clip-text bg-gradient-to-b from-blue-400 to-blue-700 dark:from-blue-400 dark:to-blue-200"
          >empresa!</span
        >
      </h1>
      <p
        class="text-xl text-slate-600 dark:text-slate-300 font-medium leading-relaxed mb-10 max-w-2xl mx-auto text-center"
      >
        Explora nuestro extenso catálogo con lo último en dispositivos y planes
        diseñados para impulsar tu negocio al máximo.
      </p>
    </div>
  </section>

  <!-- Orchestrator Component -->
  <PlansOrchestrator
    mobilePlansLibre={libreEmpresas}
    mobilePlansUltra={ultraEmpresas}
    mobilePlansInternet={movilInternetEmpresas}
    internetPlans={internetEmpresas}
  />

  <BenefitsSection />
</BaseLayout>
