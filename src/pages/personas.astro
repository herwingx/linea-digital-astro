---
// src/pages/personas.astro
import BaseLayout from "../layouts/BaseLayout.astro";
import PlansOrchestrator from "../components/features/plans/PlansOrchestrator.astro";
import BenefitsSection from "../components/sections/BenefitsSection.astro";
import "../styles/user.css";
import {
  getPlansLibre,
  getPlansUltra,
  getPlansInternet,
  getInternetEnTuCasaLibre,
} from "../services/contentful";

// --- Helper para mapear datos seguros ---
const safeMap = (plans: any[], category: "movil" | "casa") => {
  if (!Array.isArray(plans)) return [];
  return plans
    .map((p) => {
      const f = p.fields || {};
      return {
        titulo: (f.titulo as string) || "Plan",
        datosIncluidos: (f.datosIncluidos as string) || "Datos",
        precio: Number(f.precio) || 0,
        recomendado: (f.recomendado as boolean) || false,
        enlace: (f.enlace as string) || "#",
        // Campos específicos mapeados a props universales
        redesSociales: (f.redesSociales as string[]) || [],
        minutosYSms: f.minutosYSmsIncluidos as string, // Unificar nombre prop
        cashbackTelcel: f.cashbackTelcel as string,
        velocidadDeNavegacion: f.velocidadDeNavegacion as string,
        politicaDeUsoJusto:
          ((f.politicaDeUsoJusto as string) || "").trim() ||
          "Política de uso justo aplica",
      };
    })
    .filter((p) => p.precio > 0)
    .sort((a, b) => a.precio - b.precio);
};
// Fetch Paralelo para velocidad
const [rawLibre, rawUltra, rawMovilInt, rawCasaInt] = await Promise.all([
  getPlansLibre().catch(() => []),
  getPlansUltra().catch(() => []),
  getPlansInternet().catch(() => []),
  getInternetEnTuCasaLibre().catch(() => []),
]);

/* console.log("DEBUG: rawCasaInt", JSON.stringify(rawCasaInt, null, 2)); */

const librePlans = safeMap(rawLibre, "movil");
const ultraPlans = safeMap(rawUltra, "movil");
const movilInternetPlans = safeMap(rawMovilInt, "movil");
const homePlans = safeMap(rawCasaInt, "casa");
---

<BaseLayout
  title="Planes Personales | Grupo Linea Digital"
  description="Conectividad móvil y para el hogar con la mejor red de México."
>
  <!-- HERO -->
  <section class="relative pt-12 px-4 text-center overflow-hidden">
    <div class="mb-8 flex justify-center">
      <span
        class="inline-flex items-center gap-2 rounded-full border border-blue-200/60 bg-white/60 px-4 py-1.5 text-xs font-bold uppercase tracking-widest text-blue-700 backdrop-blur-md transition-all hover:scale-105 hover:bg-white/80 dark:border-blue-500/20 dark:bg-blue-900/20 dark:text-blue-300 cursor-default shadow-sm"
      >
        <span class="relative flex h-2 w-2">
          <span
            class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"
          ></span>
          <span
            class="relative inline-flex rounded-full h-2 w-2 bg-blue-500 dark:bg-blue-400"
          ></span>
        </span>
        Para Personas
      </span>
    </div>
    <h1
      class="text-4xl sm:text-5xl md:text-6xl font-bold tracking-tighter text-slate-900 dark:text-white mb-6"
    >
      Contrata Planes Telcel Libre, <span
        class="text-transparent bg-clip-text bg-gradient-to-b from-blue-400 to-blue-700 dark:from-blue-400 dark:to-blue-200"
        >sin plazo forzoso</span
      >
    </h1>
    <p
      class="text-xl text-slate-600 dark:text-slate-300 font-medium leading-relaxed mb-10 max-w-2xl mx-auto text-center"
    >
      Con los planes Telcel Libre navega con la mayor velocidad 5G y disfruta de
      GB incluidos, Minutos y SMS ilimitados en México, E.U.A. y Canadá, así
      como Redes Sociales ilimitadas y Cashback Telcel. ¡Todos estos beneficios
      ahora sin plazos forzosos!
    </p>
  </section>

  <PlansOrchestrator
    mobilePlansLibre={librePlans}
    mobilePlansUltra={ultraPlans}
    mobilePlansInternet={movilInternetPlans}
    internetPlans={homePlans}
  />

  <BenefitsSection />
</BaseLayout>
