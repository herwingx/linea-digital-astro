---
// src/pages/form.astro
import BaseLayout from '../layouts/BaseLayout.astro';
// Remove Zod validation for now to simplify
// import { z } from 'zod';

// Simple form state management
let formData = {};
let successMessage = '';

// Handle form submission
if (Astro.request.method === 'POST') {
  try {
    const formDataRaw = await Astro.request.formData();
    formData = Object.fromEntries(formDataRaw);
    
    // Basic validation
    const requiredFields = ['name', 'email', 'phone'];
    const isValid = requiredFields.every(field => formData[field]);
    
    if (isValid) {
      // Here you can add your email service integration later
      // For now, we'll just show a success message
      successMessage = '¡Mensaje enviado con éxito! Nos pondremos en contacto contigo pronto.';
      formData = {}; // Reset form
    }
  } catch (error) {
    console.error('Error processing form:', error);
  }
}
---

<BaseLayout 
  title="Contáctanos - Grupo Linea Digital" 
  description="Ponte en contacto con nosotros o únete a nuestro equipo.">
  
  <main class="bg-white text-[#002A5C] py-12 md:py-16">
    <div class="container mx-auto px-4">
      <!-- Header Section -->
      <div class="text-center mb-12">
        <h1 class="text-4xl font-bold mb-4">Contáctanos</h1>
        <p class="text-lg max-w-3xl mx-auto mb-6">
          ¿Tienes alguna pregunta o deseas unirte a nuestro equipo? Estamos aquí para ayudarte.
        </p>
        
        <!-- WhatsApp Contact Button -->
        <div class="mt-6">
          <a 
            href="https://wa.me/1234567890" 
            target="_blank" 
            rel="noopener noreferrer"
            class="inline-flex items-center px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-medium rounded-md transition-colors"
          >
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.966-.273-.099-.471-.148-.67.15-.197.297-.767.963-.94 1.16-.173.199-.347.222-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.795-1.484-1.77-1.66-2.07-.173-.297-.018-.458.132-.606.136-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.611-.916-2.207-.242-.579-.487-.5-.669-.508-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.718 2.005-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.548 4.142 1.588 5.945L0 24l6.305-1.654a11.882 11.882 0 005.74 1.466h.005c6.554 0 11.89-5.335 11.89-11.893 0-3.176-1.24-6.165-3.495-8.411"/>
            </svg>
            Escríbenos por WhatsApp
          </a>
          <p class="text-sm text-gray-600 mt-2">
            Resolución inmediata de dudas
          </p>
        </div>
      </div>

      <!-- Success Message -->
      {successMessage && (
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-8 text-center">
          {successMessage}
        </div>
      )}

      <!-- Tabs Navigation -->
      <div class="flex flex-wrap mb-8 border-b border-gray-200">
        <button 
          class="px-6 py-3 font-medium text-sm md:text-base border-b-2 border-transparent hover:border-[#002A5C] transition-colors"
          id="contact-tab"
          onclick="showForm('contact')"
        >
          Consulta General
        </button>
        <button 
          class="px-6 py-3 font-medium text-sm md:text-base border-b-2 border-transparent hover:border-[#002A5C] transition-colors"
          id="job-tab"
          onclick="showForm('job')"
        >
          Únete a Nuestro Equipo
        </button>
      </div>

      <!-- Contact Form -->
      <div id="contact-form" class="form-section">
        <form method="POST" class="max-w-2xl mx-auto" enctype="multipart/form-data">
          <input type="hidden" name="formType" value="contact" />
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- Name -->
            <div class="form-group">
              <label for="name" class="block text-sm font-medium mb-1">Nombre Completo *</label>
              <input 
                type="text" 
                id="name" 
                name="name" 
                value={formData.name || ''}
                required 
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
              />
            </div>

            <!-- Email -->
            <div class="form-group">
              <label for="email" class="block text-sm font-medium mb-1">Correo Electrónico *</label>
              <input 
                type="email" 
                id="email" 
                name="email" 
                value={formData.email || ''}
                required 
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
              />
            </div>
          </div>

          <!-- Phone -->
          <div class="mb-6">
            <label for="phone" class="block text-sm font-medium mb-1">Teléfono *</label>
            <input 
              type="tel" 
              id="phone" 
              name="phone" 
              value={formData.phone || ''}
              required 
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
            />
          </div>

          <!-- Message -->
          <div class="mb-6">
            <label for="message" class="block text-sm font-medium mb-1">Mensaje *</label>
            <textarea 
              id="message" 
              name="message" 
              rows="4" 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
            >{formData.message || ''}</textarea>
          </div>

          <button 
            type="submit" 
            class="w-full md:w-auto bg-[#002A5C] hover:bg-[#001d42] text-white font-medium py-2 px-8 rounded-md transition-colors"
          >
            Enviar Mensaje
          </button>
        </form>
      </div>

      <!-- Job Application Form (initially hidden) -->
      <div id="job-form" class="form-section hidden">
        <form method="POST" class="max-w-2xl mx-auto" enctype="multipart/form-data">
          <input type="hidden" name="formType" value="job" />
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- Name -->
            <div class="form-group">
              <label for="job-name" class="block text-sm font-medium mb-1">Nombre Completo *</label>
              <input 
                type="text" 
                id="job-name" 
                name="name" 
                value={formData.name || ''}
                required 
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
              />
            </div>

            <!-- Email -->
            <div class="form-group">
              <label for="job-email" class="block text-sm font-medium mb-1">Correo Electrónico *</label>
              <input 
                type="email" 
                id="job-email" 
                name="email" 
                value={formData.email || ''}
                required 
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
              />
            </div>
          </div>

          <!-- Phone -->
          <div class="mb-6">
            <label for="job-phone" class="block text-sm font-medium mb-1">Teléfono *</label>
            <input 
              type="tel" 
              id="job-phone" 
              name="phone" 
              value={formData.phone || ''}
              required 
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
            />
          </div>

          <!-- Position -->
          <div class="mb-6">
            <label for="position" class="block text-sm font-medium mb-1">Puesto de Interés *</label>
            <input 
              type="text" 
              id="position" 
              name="position" 
              value={formData.position || ''}
              placeholder="Ej: Desarrollador Frontend, Diseñador UX, etc." 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
            />
          </div>

          <!-- Experience Level -->
          <div class="mb-6">
            <label for="experience" class="block text-sm font-medium mb-1">Nivel de Experiencia *</label>
            <select 
              id="experience" 
              name="experience" 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
            >
              <option value="" disabled selected>Selecciona tu nivel</option>
              <option value="junior">Junior (0-2 años)</option>
              <option value="mid">Semi-Senior (2-5 años)</option>
              <option value="senior">Senior (5+ años)</option>
              <option value="director">Director/Nivel Ejecutivo</option>
            </select>
          </div>

          <!-- Resume Upload -->
          <div class="mb-6">
            <label for="resume" class="block text-sm font-medium mb-1">Sube tu CV (PDF, DOC, DOCX, máximo 5MB) *</label>
            <div class="mt-1 flex items-center">
              <label class="cursor-pointer">
                <span class="px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#002A5C]">
                  Seleccionar archivo
                </span>
                <input 
                  id="resume" 
                  name="resume" 
                  type="file" 
                  accept=".pdf,.doc,.docx" 
                  required 
                  class="sr-only"
                />
              </label>
              <span id="file-name" class="ml-2 text-sm text-gray-500">Ningún archivo seleccionado</span>
            </div>
          </div>

          <!-- LinkedIn Profile -->
          <div class="mb-6">
            <label for="linkedin" class="block text-sm font-medium mb-1">Perfil de LinkedIn</label>
            <input 
              type="url" 
              id="linkedin" 
              name="linkedin" 
              value={formData.linkedin || ''}
              placeholder="https://www.linkedin.com/in/tu-perfil"
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
            />
          </div>

          <!-- Portfolio/Website -->
          <div class="mb-6">
            <label for="portfolio" class="block text-sm font-medium mb-1">Portafolio o Sitio Web</label>
            <input 
              type="url" 
              id="portfolio" 
              name="portfolio" 
              value={formData.portfolio || ''}
              placeholder="https://www.tuportafolio.com"
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
            />
          </div>

          <!-- Availability -->
          <div class="mb-6">
            <label for="availability" class="block text-sm font-medium mb-1">Disponibilidad *</label>
            <select 
              id="availability" 
              name="availability" 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
            >
              <option value="" disabled selected>Selecciona tu disponibilidad</option>
              <option value="inmediate">Inmediata</option>
              <option value="15_days">15 días</option>
              <option value="1_month">1 mes</option>
              <option value="2_months">2 meses</option>
              <option value="3_months">3 meses o más</option>
            </select>
          </div>

          <!-- Salary Expectation -->
          <div class="mb-6">
            <label for="salary" class="block text-sm font-medium mb-1">Expectativa Salarial (Mensual)</label>
            <div class="mt-1 relative rounded-md shadow-sm">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <span class="text-gray-500 sm:text-sm">$</span>
              </div>
              <input 
                type="number" 
                id="salary" 
                name="salary" 
                min="0"
                step="500"
                value={formData.salary || ''}
                placeholder="Ej: 30000"
                class="focus:ring-[#002A5C] focus:border-[#002A5C] block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
              />
              <div class="absolute inset-y-0 right-0 flex items-center">
                <span class="text-gray-500 sm:text-sm pr-3">MXN</span>
              </div>
            </div>
          </div>

          <!-- Additional Information -->
          <div class="mb-6">
            <label for="additional_info" class="block text-sm font-medium mb-1">Información Adicional</label>
            <textarea 
              id="additional_info" 
              name="additional_info" 
              rows="4"
              placeholder="Cuéntanos más sobre ti, tus habilidades o por qué te interesa trabajar con nosotros..."
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#002A5C] focus:border-transparent"
            >{formData.additional_info || ''}</textarea>
          </div>

          <!-- Terms and Conditions -->
          <div class="mb-8">
            <div class="flex items-start">
              <div class="flex items-center h-5">
                <input 
                  id="terms" 
                  name="terms" 
                  type="checkbox" 
                  required
                  class="h-4 w-4 text-[#002A5C] focus:ring-[#002A5C] border-gray-300 rounded"
                />
              </div>
              <div class="ml-3 text-sm">
                <label for="terms" class="font-medium text-gray-700">Acepto el tratamiento de mis datos personales *</label>
                <p class="text-gray-500">Al enviar este formulario, aceptas que procesaremos tu información de acuerdo con nuestra <a href="/privacidad" class="text-[#002A5C] hover:underline">Política de Privacidad</a>.</p>
              </div>
            </div>
          </div>

          <button 
            type="submit" 
            class="w-full md:w-auto bg-[#002A5C] hover:bg-[#001d42] text-white font-medium py-3 px-10 rounded-md transition-colors text-base"
          >
            Enviar Solicitud
          </button>
        </form>
      </div>
    </div>
  </main>

  <style>
    .form-section {
      transition: all 0.3s ease;
    }
    .active-tab {
      border-bottom-color: #002A5C !important;
      color: #002A5C;
    }
  </style>

  <script>
    // Show the contact form by default
    document.addEventListener('DOMContentLoaded', () => {
      showForm('contact');
      
      // Update file name display when a file is selected
      const fileInput = document.getElementById('resume');
      const fileNameDisplay = document.getElementById('file-name');
      
      if (fileInput) {
        fileInput.addEventListener('change', (e) => {
          const fileName = e.target.files[0]?.name || 'Ningún archivo seleccionado';
          if (fileNameDisplay) fileNameDisplay.textContent = fileName;
        });
      }
      
      // Add smooth scrolling for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });
    });

    function showForm(formType) {
      // Hide all forms
      document.querySelectorAll('.form-section').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Remove active class from all tabs
      document.querySelectorAll('button[id$="-tab"]').forEach(button => {
        button.classList.remove('active-tab');
      });
      
      // Show selected form and activate tab
      const form = document.getElementById(`${formType}-form`);
      const tab = document.getElementById(`${formType}-tab`);
      
      if (form) form.classList.remove('hidden');
      if (tab) tab.classList.add('active-tab');
      
      // Scroll to form
      if (form) {
        form.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
  </script>

</BaseLayout>