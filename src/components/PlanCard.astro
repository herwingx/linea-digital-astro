---
import SocialIcon from "./SocialIcon.astro";

export interface Props {
  titulo: string;
  precio: number;
  recomendado?: boolean;
  datosIncluidos?: string;
  redesSociales?: string[];
  minutosYSms?: string;
  cashbackTelcel?: string;
  velocidadDeNavegacion?: string;
  politicasDeUso?: string;
}

const {
  titulo,
  precio,
  recomendado = false,
  datosIncluidos = "",
  redesSociales = [],
  minutosYSms = "",
  cashbackTelcel = "",
  velocidadDeNavegacion = "",
  politicasDeUso = "",
} = Astro.props;

const isHomeInternet = !!velocidadDeNavegacion;
const formattedPrice = new Intl.NumberFormat("es-MX", {
  style: "currency",
  currency: "MXN",
  maximumFractionDigits: 0,
}).format(precio);
const SALES_NUMBER = "5219614603593";
const messageBody = isHomeInternet
  ? `Hola, me interesa el servicio de Internet *${titulo}* con velocidad de *${velocidadDeNavegacion}* por *${formattedPrice}* al mes.`
  : `Hola, me interesa más información sobre el plan *${titulo}* que incluye *${datosIncluidos}* por *${formattedPrice}* al mes.`;
const whatsappUrl = `https://wa.me/${SALES_NUMBER}?text=${encodeURIComponent(messageBody)}`;
---

<!-- WRAPPER PARA PADDING (Para que al escalar no se corte la sombra) -->
<div class="w-full h-full px-1 py-4 md:py-6 pointer-events-none">
  <!-- Pointer events none para gestionar click solo en el activo luego -->

  <!-- BADGE FLOTANTE (Separado para que no se corte ni afecte al layout interno) -->
  <!-- Lo ocultamos por CSS en las cards no activas -->
  <!-- BADGE FLOTANTE (Separado para que no se corte ni afecte al layout interno) -->
  <!-- Lo ocultamos por CSS en las cards no activas -->
  {
    recomendado && (
      <div class="card-badge absolute -top-0 left-0 right-0 flex justify-center z-30 transition-opacity duration-300 opacity-0">
        <span class="inline-flex items-center gap-1 rounded-full bg-blue-600 px-3 py-1 text-[10px] font-bold uppercase tracking-widest text-white shadow-lg ring-2 ring-white dark:ring-slate-900">
          Recomendado
        </span>
      </div>
    )
  }

  <!-- CUERPO PRINCIPAL DE LA TARJETA -->
  <div
    class="plan-card-inner relative flex flex-col h-full overflow-hidden rounded-[2rem] border border-slate-200 bg-white dark:bg-slate-800 dark:border-white/5 transition-all duration-500 pointer-events-auto"
  >
    <!-- GLOW DE FONDO -->
    <div
      class="card-glow absolute -top-20 -right-20 h-64 w-64 rounded-full bg-blue-500/20 blur-3xl opacity-0 transition-opacity duration-500 pointer-events-none"
    >
    </div>

    <div class="flex flex-col h-full p-6 relative z-10">
      <!-- CABECERA -->
      <div class="flex justify-between items-start mb-4">
        <div>
          <p
            class="text-[10px] font-black uppercase tracking-widest text-blue-600 dark:text-blue-400 opacity-80"
          >
            {isHomeInternet ? "Internet Casa" : "Móvil"}
          </p>
          <h3
            class="text-xl font-bold text-slate-900 dark:text-white leading-tight"
          >
            {titulo}
          </h3>
        </div>
        <div
          class="card-icon flex h-10 w-10 items-center justify-center rounded-xl bg-slate-100 text-slate-500 dark:bg-white/5 transition-colors duration-300"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              d={isHomeInternet
                ? "M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"
                : "M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"}
            ></path></svg
          >
        </div>
      </div>

      <!-- DATO GRANDE (VELOCIDAD/GIGAS) -->
      <div
        class="mb-4 p-3 rounded-2xl bg-slate-50 dark:bg-black/20 border border-slate-100 dark:border-white/5 text-center"
      >
        <p
          class="text-2xl md:text-3xl font-extrabold text-slate-900 dark:text-white"
        >
          {isHomeInternet ? velocidadDeNavegacion : datosIncluidos}
        </p>
        <p class="text-[10px] uppercase tracking-wide text-slate-400">
          {isHomeInternet ? "Velocidad" : "Datos"}
        </p>
      </div>

      <!-- LISTA (Flex Grow para empujar footer) -->
      <div class="flex-grow space-y-3">
        {
          !isHomeInternet && (
            <div class="flex flex-wrap gap-1.5">
              {redesSociales.map((red) => (
                <div class="text-slate-400" title={red}>
                  <SocialIcon name={red} size="sm" />
                </div>
              ))}
            </div>
          )
        }
        {/* Detalles extra simplificados */}
        <p class="text-xs text-slate-500 line-clamp-2">
          {isHomeInternet ? politicasDeUso : `Incluye ${minutosYSms}`}
        </p>
        {
          cashbackTelcel && (
            <div class="inline-block px-2 py-1 rounded-md bg-amber-50 text-[10px] font-bold text-amber-600 border border-amber-100 dark:bg-amber-900/20 dark:border-amber-900/30">
              Regalo: {cashbackTelcel}
            </div>
          )
        }
      </div>

      <!-- FOOTER -->
      <div class="mt-6 pt-4 border-t border-slate-100 dark:border-white/5">
        <div class="flex justify-between items-end mb-3">
          <span class="text-[10px] uppercase text-slate-400 font-bold"
            >Mensual</span
          >
          <div class="flex items-baseline gap-0.5">
            <span class="text-2xl font-bold text-slate-900 dark:text-white"
              >{formattedPrice}</span
            >
          </div>
        </div>
        <a
          href={whatsappUrl}
          target="_blank"
          class="card-btn flex w-full items-center justify-center gap-2 rounded-xl py-3 text-xs font-bold uppercase tracking-widest transition-all duration-300 bg-slate-200 text-slate-400 cursor-not-allowed dark:bg-slate-800 dark:text-slate-600"
        >
          Lo Quiero
        </a>
      </div>
    </div>
  </div>
</div>
