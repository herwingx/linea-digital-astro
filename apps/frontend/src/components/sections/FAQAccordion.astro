---
// src/components/FAQAccordion.astro
interface Props {
  items: {
    question: string;
    answer: string;
  }[];
}

const { items } = Astro.props;
---

<div class="flex flex-col gap-4">
  {items.map((item, index) => {
    const id = `accordion-${Math.random().toString(36).substr(2, 9)}`;
    
    return (
      <div 
        class="group rounded-2xl bg-white dark:bg-[#151e2e] border border-slate-200 dark:border-white/5 transition-all duration-300 hover:shadow-lg hover:border-blue-200 dark:hover:border-blue-500/30 hover:shadow-blue-900/5"
        data-faq-item
        data-question={item.question}
        data-answer={item.answer}
      >
        <h2>
          <button
            type="button"
            class="faq-trigger flex w-full items-start justify-between gap-4 p-6 text-left focus:outline-none"
            aria-expanded="false"
            aria-controls={id}
          >
            <span class="text-base sm:text-lg font-bold text-slate-800 dark:text-slate-200 transition-colors group-hover:text-blue-600 dark:group-hover:text-blue-400">
              {item.question}
            </span>
            
            <!-- Animated Icon (+/-) -->
            <span class="relative ml-4 flex h-6 w-6 shrink-0 items-center justify-center text-slate-400 dark:text-slate-500 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
              <span class="absolute h-0.5 w-full bg-current rounded-full transform transition-transform duration-300 icon-h"></span>
              <span class="absolute h-full w-0.5 bg-current rounded-full transform transition-transform duration-300 icon-v"></span>
            </span>
          </button>
        </h2>
        
        <div
          id={id}
          class="faq-content grid grid-rows-[0fr] transition-[grid-template-rows] duration-500 ease-[cubic-bezier(0.4,0,0.2,1)]"
        >
          <div class="overflow-hidden">
            <div class="px-6 pb-6 pt-0">
              <div class="border-t border-slate-100 dark:border-white/5 pt-4 text-slate-600 dark:text-slate-400 text-base leading-relaxed">
                {item.answer}
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  })}
</div>

<script>
  function initAccordion() {
    const triggers = document.querySelectorAll('.faq-trigger');

    triggers.forEach((btn) => {
      // Limpieza para evitar listeners duplicados en ViewTransitions
      const newBtn = btn.cloneNode(true) as HTMLElement;
      btn.parentNode?.replaceChild(newBtn, btn);

      newBtn.addEventListener('click', function(this: HTMLElement) {
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        const controlsId = this.getAttribute('aria-controls');
        const content = document.getElementById(controlsId!);
        const verticalIcon = this.querySelector('.icon-v');
        
        // Update ARIA
        this.setAttribute('aria-expanded', (!isExpanded).toString());
        
        // Toggle Content
        if (content) {
            content.classList.toggle('grid-rows-[1fr]');
            content.classList.toggle('grid-rows-[0fr]');
        }

        // Animate Icon (+ to -)
        if (verticalIcon) {
            // Si rotamos 90 grados la barra vertical, se alinea con la horizontal y desaparece visualmente (forma un menos)
            // O la opacidad a 0.
            verticalIcon.classList.toggle('rotate-90'); 
            verticalIcon.classList.toggle('opacity-0');
        }
        
        // Optional: Close others (Accordion behavior instead of multiple expand)
        /* 
        document.querySelectorAll('.faq-trigger').forEach(otherBtn => {
           if(otherBtn !== this && otherBtn.getAttribute('aria-expanded') === 'true') {
               // Close logic...
           }
        });
        */
      });
    });
  }

  document.addEventListener('astro:page-load', initAccordion);
  document.addEventListener('DOMContentLoaded', initAccordion);
</script>